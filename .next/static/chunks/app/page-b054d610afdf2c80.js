(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1283:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>m});var t=a(5155),s=a(2115),r=a(4060),n=a(8086),o=a(1890);let d=(0,r.UU)(o.env.NEXT_PUBLIC_SUPABASE_URL,o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY),i=e=>{let{onSuccess:l}=e,[a,r]=(0,s.useState)(""),[i,c]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[x,h]=(0,s.useState)(""),[b,p]=(0,s.useState)("Treated"),[g,j]=(0,s.useState)(""),[N,v]=(0,s.useState)(null),[w,y]=(0,s.useState)(!1),[f,S]=(0,s.useState)(!1),[_,k]=(0,s.useState)(""),C=async e=>{if(e.preventDefault(),S(!1),k(""),!N){alert("Please select an image file.");return}y(!0);let t=null,s=null,w=null;try{var f,_;let e=await n.qg(N,{gps:!0});t=null!==(f=null==e?void 0:e.latitude)&&void 0!==f?f:null,s=null!==(_=null==e?void 0:e.longitude)&&void 0!==_?_:null,w=(null==e?void 0:e.DateTimeOriginal)?new Date(e.DateTimeOriginal).toISOString():null}catch(e){console.warn("EXIF data extraction failed:",e)}let C="".concat(Date.now(),"_").concat(N.name),{error:U}=await d.storage.from("canopeo-photos").upload(C,N);if(U){console.error("Image upload failed:",U),k("Image upload failed. Please try again."),y(!1);return}let P="".concat(o.env.NEXT_PUBLIC_SUPABASE_URL,"/storage/v1/object/public/canopeo-photos/").concat(C),{error:T}=await d.from("photo_submissions").insert([{grower_name:a,dealer_name:i,crop_type:u,product_used:x,notes:g,upload_type:b,image_url:P,latitude:t,longitude:s,timestamp:w}]);T?(console.error("Metadata insert failed:",T),k("Metadata submission failed.")):(S(!0),l({grower_name:a,dealer_name:i,crop_type:u,product_used:x,notes:g,upload_type:b,image_url:P,latitude:t,longitude:s,timestamp:w}),r(""),c(""),m(""),h(""),p("Treated"),j(""),v(null)),y(!1)};return(0,t.jsxs)("form",{onSubmit:C,className:"max-w-xl mx-auto p-6 bg-white dark:bg-gray-900 shadow-md rounded text-black dark:text-white",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Submit Field Photo"}),(0,t.jsx)("label",{className:"block mb-2",children:"Grower / Cooperator / Knowledge Plot Name"}),(0,t.jsx)("input",{type:"text",value:a,onChange:e=>r(e.target.value),className:"w-full mb-4 p-2 border rounded bg-white dark:bg-gray-800",required:!0}),(0,t.jsx)("label",{className:"block mb-2",children:"Dealer / Account Manager Name"}),(0,t.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),className:"w-full mb-4 p-2 border rounded bg-white dark:bg-gray-800"}),(0,t.jsx)("label",{className:"block mb-2",children:"Crop Type"}),(0,t.jsxs)("select",{value:u,onChange:e=>m(e.target.value),className:"w-full mb-4 p-2 border rounded bg-white dark:bg-gray-800",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select Crop"}),(0,t.jsx)("option",{value:"Corn",children:"Corn"}),(0,t.jsx)("option",{value:"Soybeans",children:"Soybeans"}),(0,t.jsx)("option",{value:"Wheat",children:"Wheat"}),(0,t.jsx)("option",{value:"Sorghum",children:"Sorghum"}),(0,t.jsx)("option",{value:"Other",children:"Other"})]}),(0,t.jsx)("label",{className:"block mb-2",children:"Product Used"}),(0,t.jsx)("input",{type:"text",value:x,onChange:e=>h(e.target.value),className:"w-full mb-4 p-2 border rounded bg-white dark:bg-gray-800",required:!0}),(0,t.jsx)("label",{className:"block mb-2",children:"Upload Type"}),(0,t.jsxs)("select",{value:b,onChange:e=>p(e.target.value),className:"w-full mb-4 p-2 border rounded bg-white dark:bg-gray-800",children:[(0,t.jsx)("option",{value:"Treated",children:"Treated"}),(0,t.jsx)("option",{value:"Untreated",children:"Untreated"})]}),(0,t.jsx)("label",{className:"block mb-2",children:"Optional Notes"}),(0,t.jsx)("textarea",{value:g,onChange:e=>j(e.target.value),className:"w-full mb-4 p-2 border rounded bg-white dark:bg-gray-800"}),(0,t.jsx)("label",{className:"block mb-2",children:"Photo Upload"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var l;return v((null===(l=e.target.files)||void 0===l?void 0:l[0])||null)},className:"mb-4",required:!0}),(0,t.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50",disabled:w,children:w?"Submitting...":"Submit"}),f&&(0,t.jsx)("p",{className:"text-green-600 mt-4",children:"✅ Submission successful!"}),_&&(0,t.jsxs)("p",{className:"text-red-600 mt-4",children:["❌ ",_]})]})};var c=a(3319);let u=e=>{let{data:l}=e,{grower_name:a,dealer_name:s,crop_type:r,product_used:n,upload_type:o,notes:d,image_url:i,latitude:u,longitude:m,timestamp:x}=l,h=x?(0,c.GP)(new Date(x),"yyyy-MM-dd HH:mm:ss"):"N/A";return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-white dark:bg-gray-900 shadow-md rounded text-black dark:text-white",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-6 border-b pb-2",children:"Submission Summary"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:"Grower / Cooperator"}),(0,t.jsx)("p",{children:a})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:"Dealer / Account Manager"}),(0,t.jsx)("p",{children:s})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:"Crop Type"}),(0,t.jsx)("p",{children:r})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:"Product Used"}),(0,t.jsx)("p",{children:n})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:"Upload Type"}),(0,t.jsx)("p",{children:o})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:"Timestamp"}),(0,t.jsx)("p",{children:h})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:"Latitude"}),(0,t.jsx)("p",{children:null!=u?u:"N/A"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:"Longitude"}),(0,t.jsx)("p",{children:null!=m?m:"N/A"})]}),(0,t.jsxs)("div",{className:"sm:col-span-2",children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:"Optional Notes"}),(0,t.jsx)("p",{children:d||"N/A"})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-600 mb-2",children:"Photo Preview"}),(0,t.jsx)("img",{src:i,alt:"Uploaded field",className:"w-full max-w-lg rounded shadow"})]})]})};function m(){let[e,l]=(0,s.useState)(null);return(0,t.jsxs)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 p-4",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-center text-black dark:text-white mb-6",children:"YMS Crop Capture"}),(0,t.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,t.jsx)(i,{onSuccess:l}),e&&(0,t.jsx)(u,{data:e})]})]})}},8218:(e,l,a)=>{Promise.resolve().then(a.bind(a,1283))}},e=>{var l=l=>e(e.s=l);e.O(0,[801,441,684,358],()=>l(8218)),_N_E=e.O()}]);